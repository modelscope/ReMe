failure_step_experience_prompt: |
  You are an expert AI analyst reviewing failed step sequences from an AI agent execution.
  
  Your task is to extract learning experiences from failures to prevent similar mistakes in future executions.
  Focus on identifying error patterns, missed opportunities, and alternative approaches.
  
  ANALYSIS FRAMEWORK:
  ● FAILURE POINT IDENTIFICATION: Pinpoint where and why the steps went wrong
  ● ERROR PATTERN ANALYSIS: Identify recurring mistakes or problematic approaches
  ● ALTERNATIVE APPROACHES: Suggest what could have been done differently
  ● PREVENTION STRATEGIES: Extract actionable insights to avoid similar failures
  
  EXTRACTION PRINCIPLES:
  ● Extract GENERAL PRINCIPLES as well as SPECIFIC INSTRUCTIONS
  ● Focus on PATTERNS and RULES as well as particular instances
  
  # Original Query
  {query}
  
  # Step Sequence Analysis
  {step_sequence}
  
  # Context Information
  {context}
  
  # Outcome
  This step sequence was part of a {outcome} trajectory.
  
  OUTPUT FORMAT:
  Generate 1-3 step-level failure prevention insights as JSON objects:
  ```json
  [
    {{
      "when_to_use": "Specific situations where this lesson should be remembered",
      "experience": "Universal principle or rule extracted from the failure pattern ",
      "tags": ["error_prevention", "failure_analysis", "relevant_keywords"],
      "confidence": 0.7,
      "step_type": "reasoning|action|observation|decision",
      "tools_used": ["list", "of", "tools"]
    }}
  ]
  ```

failure_step_experience_with_query_prompt: |
  You are an expert AI analyst reviewing failed step sequences from an AI agent execution.
  
  Your task is to extract learning experiences from failures to prevent similar mistakes in future executions.
  Focus on identifying error patterns, missed opportunities, and alternative approaches.
  
  ANALYSIS FRAMEWORK:
  ● FAILURE POINT IDENTIFICATION: Pinpoint where and why the steps went wrong
  ● ERROR PATTERN ANALYSIS: Identify recurring mistakes or problematic approaches
  ● ALTERNATIVE APPROACHES: Suggest what could have been done differently
  ● PREVENTION STRATEGIES: Extract actionable insights to avoid similar failures
  
  EXTRACTION PRINCIPLES:
  ● Extract GENERAL PRINCIPLES as well as SPECIFIC INSTRUCTIONS
  ● Focus on PATTERNS and RULES as well as particular instances
  
  # Original Query
  {query}
  
  # Step Sequence Analysis
  {step_sequence}
  
  # Context Information
  {context}
  
  # Outcome
  This step sequence was part of a {outcome} trajectory.
  
  OUTPUT FORMAT:
  Generate 1-3 step-level failure prevention insights as JSON objects:
  ```json
  [
    {{
      "when_to_use": "Specific situations where this lesson should be remembered",
      "task_query": "Identify the specific task query from the original trajectory that this lesson is most closely related to. Extract the exact query text.",
      "generalized_query": "Abstract the specific task query to create a more generalized task representation.",
      "experience": "Universal principle or rule extracted from the failure pattern ",
      "tags": ["relevant", "keywords", "from", "the", "task", "query"],
      "confidence": 0.7,
      "step_type": "reasoning|action|observation|decision",
      "tools_used": ["list", "of", "tools"]
    }}
  ]
  ```

failure_traj_experience_prompt: |
  You are an expert AI analyst reviewing failed step sequences from an AI agent execution.
  
  Your task is to extract learning experiences from failures to prevent similar mistakes in future executions.
  Focus on reflections from this failed trajectory and alternative step-by-step planning.
  
  ANALYSIS FRAMEWORK:
  ● FAILURE POINT IDENTIFICATION: Point why this trajectory failed to solve this task
  ● ERROR PATTERN ANALYSIS: Identify recurring mistakes or problematic approaches
  ● ALTERNATIVE APPROACHES: Suggest how to plan differently to avoid similar failures
  
  EXTRACTION PRINCIPLES:
  ● Extract GENERAL PRINCIPLES as well as SPECIFIC INSTRUCTIONS
  ● Focus on PATTERNS and RULES as well as particular instances
  
  # Original Query
  {query}
  
  # Step Sequence Analysis
  {step_sequence}
  
  # Context Information
  {context}
  
  # Outcome
  This step sequence was part of a {outcome} trajectory.
  
  OUTPUT FORMAT:
  Generate 1-3 trajectory-level failure prevention insights as JSON objects:
  ```json
  [
    {{
      "when_to_use": "Specific situations where this lesson should be remembered",
      "experience": "Universal failure prevention step-by-step plan learned from the failed trajectory",
      "tags": ["error_prevention", "failure_analysis", "relevant_keywords"],
      "confidence": 0.7,
      "tools_used": ["list", "of", "tools"]
    }}
  ]
  ```